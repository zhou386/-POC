# 飞企互联FE企业运营管理平台SQL注入漏洞检测脚本

## 脚本概述
该Python脚本用于检测指定URL是否存在**飞企互联FE企业运营管理平台的SQL注入漏洞**。脚本通过向目标URL发送包含特定Payload的GET请求，并基于服务器响应时间（延迟注入原理）判断漏洞是否存在——若响应时间落在4-6秒区间内，则判定为可能存在漏洞。


## 漏洞背景
飞企互联FE企业运营管理平台的部分接口（如`ajax_codewidget39.jsp`、`checkGroupCode.jsp`等）存在SQL注入漏洞。攻击者可利用该漏洞构造恶意SQL语句，执行未授权的数据查询、修改甚至服务器命令，对系统安全性造成严重威胁。

本脚本针对该漏洞的**时间延迟注入特性**设计检测逻辑，通过`waitfor delay '0:0:4'`语句强制数据库延迟响应，以此验证漏洞是否存在。


## 环境依赖
### 运行环境
- Python 3.6 及以上版本（推荐Python 3.8+）
- 支持跨平台运行（Windows/macOS/Linux）

### 依赖库
脚本基于Python标准库开发，**无需额外安装第三方库**，依赖的标准库包括：
- `http.client`：用于建立HTTP/HTTPS连接并发送请求
- `ssl`：处理HTTPS连接的SSL证书验证（脚本默认忽略证书验证）
- `argparse`：解析命令行参数
- `urllib.parse`：解析目标URL的协议、域名、路径等信息
- `time`：计算请求响应时间


## 快速开始
### 1. 脚本获取
将脚本文件（如`fe_sql_injection_check.py`）保存到本地，确保文件名与实际脚本一致。

### 2. 命令行参数说明
脚本支持两种输入方式（单个URL或URL列表文件），通过命令行参数指定目标，参数说明如下：

| 参数         | 简写 | 功能描述                                                                 | 示例                                  |
|--------------|------|--------------------------------------------------------------------------|---------------------------------------|
| `--url`      | `-u` | 指定单个待检测的目标URL（支持`http://`或`https://`协议，若未指定协议则默认补全`http://`） | `-u https://example.com`              |
| `--file`     | `-f` | 指定包含多个URL的文本文件（每行1个URL，支持自动补全`http://`协议）       | `-f urls.txt`                         |


### 3. 运行示例
#### 示例1：检测单个URL
```bash
python fe_sql_injection_check.py -u https://target-domain.com
```

#### 示例2：检测文件中的多个URL
1. 准备URL列表文件（如`urls.txt`），格式如下：
   ```txt
   https://target1.com
   target2.com  # 脚本会自动补全为 http://target2.com
   http://target3.com:8080  # 支持带端口的URL
   ```
2. 执行检测命令：
   ```bash
   python fe_sql_injection_check.py -f urls.txt
   ```


## 检测原理
1. **Payload设计**：脚本内置3个漏洞检测路径（`endpoint`），每个路径均携带SQL延迟注入Payload：
   ```
   /common/ajax_codewidget39.jsp;.js?code=1%27;waitfor+delay+%270:0:4%27--+
   /common/efficientCodewidget39.jsp;.js?code=1%27;waitfor+delay+%270:0:4%27--+
   /docexchangeManage/checkGroupCode.jsp;.js?code=1%27;waitfor+delay+%270:0:4%27--+
   ```
   其中`waitfor delay '0:0:4'`是关键Payload，用于强制数据库延迟4秒响应。

2. **响应时间判断**：
   - 脚本记录发送请求到接收响应的总耗时（`elapsed_time`）。
   - 若耗时在 **4秒 ≤ elapsed_time < 6秒** 区间内：判定为**可能存在漏洞**（输出红色警告信息）。
   - 若耗时不在上述区间：判定为**不存在漏洞**（输出正常提示）。
   - 若请求失败（如网络超时、URL无效）：输出错误原因。


## 输出说明
脚本输出信息包含颜色标识，便于快速识别结果：
- **红色文字**：`URL [xxx] 可能存在飞企互联FE企业运营管理平台 [endpoint] SQL注入漏洞` → 高危风险，需优先排查。
- **默认颜色文字**：
  - `URL [xxx] 不存在漏洞` → 未检测到漏洞。
  - `URL [xxx] 请求失败: [错误信息]` → 请求异常（如网络不通、目标服务器无响应），需检查目标可达性。


## 注意事项
1. **合法性声明**
   - 本脚本仅用于**合法授权的安全测试**（如企业内部系统自查、已获得授权的第三方渗透测试）。
   - 禁止将脚本用于未经授权的攻击行为，否则需承担相应法律责任。

2. **SSL证书处理**
   - 脚本默认通过`ssl._create_unverified_context()`忽略SSL证书验证，适用于测试环境或自签名证书场景。
   - 若需严格验证SSL证书（如生产环境），可删除`context=ssl._create_unverified_context()`参数（此时无效证书会导致请求失败）。

3. **检测局限性**
   - 漏洞判断依赖响应时间，若目标服务器存在网络波动、负载过高，可能导致误判（建议多次检测确认结果）。
   - 脚本仅覆盖已知的3个漏洞路径，若目标系统存在其他未收录的漏洞路径，可能导致漏判。

4. **性能影响**
   - 每个URL需检测3个`endpoint`，每个请求最大等待时间约6秒，批量检测时需注意耗时（建议控制URL数量，避免并发过高）。


## 问题排查
若脚本运行异常，可按以下步骤排查：
1. **Python版本问题**：执行`python --version`确认版本≥3.6，若版本过低需升级Python。
2. **URL格式问题**：确保URL不包含特殊字符（如空格），文件中的URL需每行1个，无多余空行。
3. **网络问题**：通过`ping 目标域名`或`curl 目标URL`验证目标是否可达，排除防火墙拦截、网络不通等问题。
4. **权限问题**：若读取URL列表文件时提示“权限不足”，需检查文件读写权限（如Windows下右键“以管理员身份运行”，Linux下加`sudo`）。
