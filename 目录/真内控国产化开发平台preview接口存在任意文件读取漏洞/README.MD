# 真内控国产化开发平台 preview 接口任意文件读取漏洞检测工具 README

## 工具简介
本工具用于检测**真内控国产化开发平台**的 `/print/billPdf/preview` 接口是否存在**任意文件读取漏洞**。该漏洞通过构造特定路径的请求参数，可读取服务器上的敏感文件（如 `/etc/passwd`），工具通过检测目标是否能成功返回 `/etc/passwd` 中的特征内容（`root:x:0:0:root:/root:/bin/bash`）来判断漏洞是否存在。

工具支持**单URL检测**和**多URL批量检测**，并通过多线程（默认100线程）提升批量检测效率，最终将存在漏洞的目标保存至 `result.txt` 文件中。


## 漏洞背景
- **漏洞接口**：`/print/billPdf/preview`
- **漏洞原理**：接口的 `urlPath` 参数未对用户输入进行严格的路径过滤和校验，允许使用 `../../` 等路径穿越符访问服务器任意目录下的文件
- **检测依据**：向目标接口发送读取 `/etc/passwd`（Linux系统默认敏感文件）的请求，若响应中包含 `root:x:0:0:root:/root:/bin/bash`（`/etc/passwd` 中root用户的特征行），则判定目标存在漏洞


## 环境依赖
| 依赖项       | 版本要求       | 说明                     |
|--------------|----------------|--------------------------|
| Python       | 3.6 及以上     | 工具基于Python 3开发     |
| requests     | 任意稳定版本   | 用于发送HTTP请求         |
| multiprocessing | 内置模块     | 用于实现多线程批量检测   |

### 依赖安装命令
若未安装 `requests` 库，执行以下命令安装：
```bash
pip install requests
```


## 工具使用说明
### 1. 命令行参数说明
工具通过命令行参数指定检测目标，支持两种模式（单URL/多URL），参数说明如下：

| 参数         | 简写 | 作用                     | 示例                          |
|--------------|------|--------------------------|-------------------------------|
| `--url`      | `-u` | 指定单个检测目标URL      | `-u http://192.168.1.100`     |
| `--file`     | `-f` | 指定包含多个URL的文件路径 | `-f target_urls.txt`          |
| `--help`     | `-h` | 查看工具使用帮助         | `-h`                          |

### 2. 具体使用场景
#### 场景1：单URL检测
检测单个目标是否存在漏洞，命令格式：
```bash
python 工具文件名.py -u 目标URL
```
**示例**：
```bash
python poc.py -u http://192.168.1.100:8080
```
- 若目标URL未带 `http://` 或 `https://`，工具会自动补全 `http://`（如输入 `192.168.1.100`，工具会处理为 `http://192.168.1.100`）


#### 场景2：多URL批量检测
检测多个目标（需将所有目标URL按行存入文本文件），命令格式：
```bash
python 工具文件名.py -f URL列表文件路径
```
**示例**：
1. 先创建 `target_urls.txt` 文件，内容格式如下（每行一个URL）：
   ```txt
   http://192.168.1.100
   http://192.168.1.101:8080
   192.168.1.102:9090  # 工具会自动补全http://
   ```
2. 执行批量检测命令：
   ```bash
   python poc.py -f target_urls.txt
   ```
- 批量检测默认开启 **100线程**，可通过修改代码中 `Pool(100)` 的数值调整线程数（如 `Pool(50)` 改为50线程，避免线程过多导致目标服务器拒绝服务）


#### 场景3：查看帮助
若忘记参数用法，执行以下命令查看帮助信息：
```bash
python 工具文件名.py -h
```
输出结果如下（帮助说明）：
```
usage: 工具文件名.py [-h] [-u URL] [-f FILE]

真内控国产化开发平台preview接口存在任意文件读取漏洞

optional arguments:
  -h, --help            show this help message and exit
  -u URL, --url URL     place input lik (此处应为"请输入目标URL")
  -f FILE, --file FILE  place input your le path (此处应为"请输入URL列表文件路径")
```


## 输出结果说明
工具运行过程中会实时在控制台输出检测状态，最终结果分为以下4类：

| 输出标识 | 含义说明                                                                 |
|----------|--------------------------------------------------------------------------|
| `[+]`    | 目标存在漏洞（如 `[+] http://192.168.1.100 存在sql漏洞`，注：代码中此处为笔误，实际为“任意文件读取漏洞”） |
| `[-]`    | 目标不存在任意文件读取漏洞（如 `[-] 该http://192.168.1.101 不存在任意读取漏洞`） |
| `[*]`    | 目标访问异常（如HTTP状态码非200，需手工测试，输出 `[*] 该http://192.168.1.102 存在问题,请手工测试`） |
| 无输出    | 目标连接失败（如网络不通、端口未开放，工具会捕获异常并跳过，无额外输出） |


## 结果文件说明
工具会自动生成 `result.txt` 文件（若文件已存在，会在末尾追加内容），仅保存**存在漏洞的目标URL**，格式为每行一个URL，便于后续批量处理。

**示例 `result.txt` 内容**：
```txt
http://192.168.1.100
http://192.168.1.103:8080
```


## 注意事项
1. **合法性声明**：本工具仅用于**合法授权的安全测试**（如企业内部资产检测、经客户允许的渗透测试），禁止用于未授权的攻击行为，使用者需承担相应法律责任。
2. **线程数调整**：批量检测时，若目标服务器性能较弱，建议降低线程数（如将 `Pool(100)` 改为 `Pool(20)`），避免因并发请求过多导致目标服务器宕机。
3. **HTTPS支持**：工具支持检测HTTPS目标（若目标URL以 `https://` 开头，会自动使用HTTPS协议发送请求）。
4. **代码笔误修正**：原代码中存在一处文字错误（将“任意文件读取漏洞”误写为“sql漏洞”），若需修正，可将 `print(f"[+]{target}存在sql漏洞")` 改为 `print(f"[+]{target}存在任意文件读取漏洞")`。
5. **异常处理**：工具仅捕获请求过程中的异常（如连接超时、网络错误），若需更详细的错误日志，可在 `except` 块中添加 `print(f"[!] {target} 检测异常: {str(e)}")`（需先导入 `traceback` 或定义 `e` 变量）。


## 工具更新与维护
- 若目标系统修复了该漏洞（如过滤 `urlPath` 参数中的路径穿越符），工具可能无法准确检测，需根据新的漏洞利用方式更新 `payload`。
- 若需扩展检测其他敏感文件（如Windows系统的 `C:\Windows\win.ini`），可修改 `payload` 中的 `urlPath` 参数（如 `/print/billPdf/preview?urlPath=../../../../../../../../../../../../../../Windows/win.ini`），并调整漏洞判断条件（如检测 `[Windows]` 特征行）。
